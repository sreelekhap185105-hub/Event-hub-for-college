<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Events - Event Management</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>

/* THEME VARIABLES */
:root {
  --bg: #f6f0ff;
  --card: #ffffff;
  --text: #333;
  --nav-text: #4e54c8;
  --primary: #4e54c8;
  --primary-light: #8f94fb;
  --timer-bg: #d5eadb;
  --timer-text: #1da73d;
}

/* DARK THEME */
.dark-theme {
  --bg: #1c1e26;
  --card: #2a2d38;
  --text: #e6e6e6;
  --nav-text: #b7bcff;
  --primary: #7d83ff;
  --primary-light: #acb1ff;
  --timer-bg: #2f4f39;
  --timer-text: #7dffae;
}

/* APPLY VARIABLES */
body {
  font-family:'Inter', sans-serif;
  background: var(--bg);
  padding:2rem;
  position:relative;
  color:var(--text);
  transition:0.3s ease;
}

h1 {
  font-size:2.5rem;
  margin-bottom:2rem;
  background:linear-gradient(90deg,var(--primary),var(--primary-light));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-align:center;
}

nav { display:flex; gap:1rem; margin-bottom:2rem; justify-content:center; flex-wrap:wrap; }
nav a {
  text-decoration:none;
  color:var(--nav-text);
  font-weight:600;
  padding:0.5rem 1rem;
  border-radius:10px;
  transition:0.3s;
  background:var(--card);
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
nav a:hover { background:var(--primary); color:#fff; }

/* THEME SWITCH BUTTON */
.theme-toggle {
  position:absolute;
  top:2rem;
  left:2rem;
  background:var(--card);
  padding:0.5rem 1.2rem;
  border-radius:20px;
  cursor:pointer;
  font-weight:700;
  color:var(--primary);
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
  transition:0.3s;
}
.theme-toggle:hover { background:var(--primary); color:#fff; }

/* Profile section */
.profile {
  position:absolute; top:2rem; right:2rem;
  display:flex; align-items:center; gap:0.8rem;
  background:var(--card);
  padding:0.5rem 1rem;
  border-radius:50px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
.profile img { width:40px; height:40px; border-radius:50%; }
.profile span { font-weight:600; color:var(--primary); }
.profile button {
  padding:0.3rem 0.8rem; border:none;
  border-radius:30px; cursor:pointer;
  background:var(--primary); color:#fff;
  font-weight:600; transition:0.3s;
}
.profile button:hover { background:var(--primary-light); }

.add-event-btn {
  display:inline-block; margin-bottom:1.5rem;
  padding:0.6rem 1.2rem; background:var(--primary);
  color:#fff; border:none; border-radius:50px;
  font-weight:600; cursor:pointer; transition:0.3s;
}
.add-event-btn:hover { background:var(--primary-light); }

/* Event Cards Grid */
#eventsContainer {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 5.5rem;
  max-width: 800px;
  margin: 0 auto;
}
@media(max-width:700px){
  #eventsContainer { grid-template-columns: 1fr; max-width:100%; padding:0 1rem; }
}

.event-card {
  background:var(--card);
  border-radius:10px;
  box-shadow:0 10px 20px rgba(0,0,0,0.1);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition:0.3s;
  max-width:380px;
  margin: 0 auto;
}
.event-card:hover { transform: translateY(-5px); }

.event-card img {
  width:100%; height:180px;
  object-fit:cover; border-radius: 10px;
}

.event-card .content {
  padding:0.8rem 1rem 1rem 1rem;
  flex-grow:1;
  display:flex;
  flex-direction:column;
}

.event-card h3 {
  font-size: 1.6rem;
  margin-bottom: 0.4rem;
  margin-top: -0.3rem;
  color: var(--primary);
  text-align: center;
}

.event-card p {
  color:var(--text);
  font-size:1.2rem;
  margin:0; line-height:1.3;
}

.event-card .event-detail { margin-bottom:0.2rem; }
.event-card .event-detail strong { color:var(--text); }

/* Timer */
.event-card .timer {
  margin-top:0.3rem;
  font-weight:600;
  color:var(--timer-text);
  font-size:1rem;
  text-align:center;
  background:var(--timer-bg);
  padding:0.2rem 0.5rem;
  border-radius:8px;
}

.event-card button {
  padding:0.4rem 0.8rem;
  border:none;
  border-radius:50px;
  font-weight:600;
  cursor:pointer;
  transition:0.3s;
  margin-right:0.3rem;
  font-size:0.85rem;
}
.book-btn { background:var(--primary); color:#fff; }
.book-btn:hover { background:var(--primary-light); }

/* NEW FAQ BUTTON STYLE */
.faq-btn { background:#555; color:#fff; }
.faq-btn:hover { background:#777; }

.edit-btn { background:#ffa500; color:#fff; }
.edit-btn:hover { background:#ffb84d; }
.delete-btn { background:#e74c3c; color:#fff; }
.delete-btn:hover { background:#ff6659; }

.event-actions { margin-top:0.8rem; display:flex; gap:0.3rem; flex-wrap:wrap; }
</style>
</head>
<body>

<h1>Upcoming Events</h1>

<!-- ADDED THEME SWITCH BUTTON -->
<div class="theme-toggle" id="themeToggle">Theme</div>

<nav id="navbar"></nav>

<!-- PROFILE SECTION - Will be hidden for teachers via JS -->
<div class="profile" id="profile">
  <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile Picture">
  <span id="profileName"></span>
  <button id="logoutBtn">Logout</button>
</div>

<div id="teacherControls"></div>

<div id="eventsContainer"></div>

<script>
/* THEME TOGGLE */
const themeKey = "eventTheme";
if(localStorage.getItem(themeKey) === "dark") {
    document.body.classList.add("dark-theme");
}
document.getElementById("themeToggle").onclick = function() {
    document.body.classList.toggle("dark-theme");
    localStorage.setItem(themeKey,
        document.body.classList.contains("dark-theme") ? "dark" : "light"
    );
};

/* --- AUTH & NAVIGATION LOGIC --- */
const username = localStorage.getItem('username');
const role = localStorage.getItem('role');
if(!username || !role){ window.location.href='login.html'; }

// Update profile name and setup logout listener
document.getElementById('profileName').innerText = username;
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  localStorage.removeItem('username');
  localStorage.removeItem('role');
  window.location.href='login.html';
});

const navbar = document.getElementById('navbar');
const profileElement = document.getElementById('profile'); // Get profile element

if(role==='teacher'){
  // 1. Hide the profile box
  if (profileElement) {
    profileElement.style.display = 'none';
  }

  // 2. Update navigation: Add Analytics, Remove Profile
  navbar.innerHTML = `
    <a href="events.html">Events</a>
    <a href="bookings.html">All Bookings</a>
    <a href="analytics.html">Analytics</a>
    <a href="add-event.html">Add Event</a>
    <a href="scanner.html">QR Scanner</a>`;
} else {
  // Student navigation (unchanged)
  navbar.innerHTML = `
    <a href="events.html">Events</a>
    <a href="bookings.html">My Bookings</a>
    <a href="profile.html">Profile</a>`;
}

/* --- EVENT RENDERING AND TIMER LOGIC --- */
let events = JSON.parse(localStorage.getItem('eventsList')) || [];

function updateTimers(){
  document.querySelectorAll('.event-card').forEach((card,index)=>{
    const timerEl = card.querySelector('.timer');
    if(!timerEl) return;
    const event = events[index];
    const now = new Date();
    const eventDate = new Date(`${event.date}T${event.time}`);
    let diff = eventDate - now;
    if(diff<=0){
      timerEl.innerText = "Event started!";
    } else {
      let days = Math.floor(diff/1000/60/60/24);
      let hours = Math.floor((diff/1000/60/60)%24);
      let minutes = Math.floor((diff/1000/60)%60); // Re-added minutes fix
      let seconds = Math.floor((diff/1000)%60);
      timerEl.innerText = `Starts in: ${days}d ${hours}h ${minutes}m ${seconds}s`; // Re-added minutes to display
    }
  });
}

function renderEvents(){
  const container = document.getElementById('eventsContainer');
  container.innerHTML='';
  events.forEach((event,index)=>{
    const card = document.createElement('div');
    card.classList.add('event-card');
    const eventImage = event.image && event.image.trim()!=='' ? event.image : 'https://source.unsplash.com/400x200/?event';
    let actionsHTML='';
    
    // MODIFIED: Added FAQ button for student role
    if(role==='student'){
      actionsHTML = `<div class="event-actions">
        <button class="book-btn">Book Now</button>
        <button class="faq-btn">FAQ</button>
      </div>`;
    } else if(role==='teacher'){
      actionsHTML = `<div class="event-actions">
        <button class="edit-btn">Edit</button>
        <button class="delete-btn">Delete</button>
      </div>`;
    }

    card.innerHTML=`
      <img src="${eventImage}" alt="${event.name}">
      <div class="content">
        <h3>${event.name}</h3>
        <p class="event-detail"><strong>Description:</strong> ${event.description}</p>
        <p class="event-detail"><strong>Date:</strong> ${event.date}</p>
        <p class="event-detail"><strong>Time:</strong> ${event.time}</p>
        <p class="event-detail"><strong>Venue:</strong> ${event.venue}</p>
        <div class="timer">Loading timer...</div>
        ${actionsHTML}
      </div>
    `;

    container.appendChild(card);

    if(role==='student'){
      card.querySelector('.book-btn').addEventListener('click', ()=>{
        localStorage.setItem('selectedEvent',JSON.stringify(event));
        localStorage.setItem('studentName',username);
        window.location.href='booking-form.html';
      });
      // NEW: FAQ button event listener
      card.querySelector('.faq-btn').addEventListener('click', ()=>{
        window.location.href='faq.html';
      });
    }

    if(role==='teacher'){
      card.querySelector('.edit-btn').addEventListener('click', ()=>{
        localStorage.setItem('editEventIndex',index);
        window.location.href='add-event.html';
      });
      card.querySelector('.delete-btn').addEventListener('click', ()=>{
        // Fixed: Replaced confirm() with a custom modal
        const modal = document.createElement('div');
        modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;';
        modal.innerHTML = `
            <div style="background:var(--card);padding:20px;border-radius:10px;text-align:center;max-width:300px;box-shadow:0 5px 15px rgba(0,0,0,0.3);">
                <p style="color:var(--text);">Are you sure you want to delete "${event.name}"?</p>
                <button id="confirmDelete" style="background:#e74c3c;color:#fff;padding:8px 15px;border:none;border-radius:5px;margin-right:10px;cursor:pointer;">Delete</button>
                <button id="cancelDelete" style="background:#ccc;color:#333;padding:8px 15px;border:none;border-radius:5px;cursor:pointer;">Cancel</button>
            </div>
        `;
        document.body.appendChild(modal);
        
        document.getElementById('confirmDelete').onclick = () => {
            events.splice(index,1);
            localStorage.setItem('eventsList',JSON.stringify(events));
            renderEvents();
            document.body.removeChild(modal);
        };
        document.getElementById('cancelDelete').onclick = () => {
            document.body.removeChild(modal);
        };
      });
    }
  });

  updateTimers();
  setInterval(updateTimers,1000);
}

renderEvents();

if(role==='teacher'){
  const teacherDiv = document.getElementById('teacherControls');
  const addBtn = document.createElement('button');
  addBtn.classList.add('add-event-btn');
  addBtn.innerText = "Add New Event";
  teacherDiv.appendChild(addBtn);
  addBtn.addEventListener('click',()=>{ window.location.href='add-event.html'; });
}
</script>
</body>
</html>